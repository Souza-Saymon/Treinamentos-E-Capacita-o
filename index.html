<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treinamento Eztec</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/pt.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        :root {
            --eztec-cereja: #D01139;
            --eztec-cacau: #350F15;
            --white-smoke: #F4F4F4;
            --grey-nickel: #CAC4C4;
            --success-green: #28a745;
        }

        body { 
            font-family: 'Sarabun', sans-serif; 
            background-color: var(--white-smoke); 
            margin: 0; padding: 20px;
            color: var(--eztec-cacau);
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card { 
            background: #ffffff; padding: 40px; border-radius: 4px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            max-width: 650px; width: 100%;
            border-top: 5px solid var(--eztec-cereja);
            animation: fadeIn 0.6s ease-out;
            position: relative;
        }

        .header-logo { text-align: center; margin-bottom: 30px; }
        .header-logo img { max-width: 160px; height: auto; }

        h2 { font-weight: 600; font-size: 19px; text-align: center; margin-bottom: 30px; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        @media (max-width: 600px) {
            .grid { grid-template-columns: 1fr; } 
            .card { padding: 25px 20px; }
        }

        label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: #666; }

        input, select { 
            width: 100%; padding: 11px; border: 1px solid var(--grey-nickel); 
            border-radius: 2px; font-family: 'Sarabun', sans-serif; 
            font-size: 15px; outline: none; transition: border 0.3s;
        }

        input:focus { border-color: var(--eztec-cereja); }

        /* SKELETON LOADING */
        @keyframes skeleton-loading {
            0% { background-position: -200px 0; }
            100% { background-position: calc(200px + 100%) 0; }
        }
        .loading-skeleton {
            background-image: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200px 100%;
            animation: skeleton-loading 1.2s infinite linear;
            color: transparent !important;
        }

        button { 
            width: 100%; padding: 16px; background-color: var(--eztec-cereja); color: white; 
            border: none; border-radius: 2px; font-weight: 700; cursor: pointer; 
            margin-top: 30px; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s;
        }
        button:hover { background-color: var(--eztec-cacau); }

        /* TELA DE SUCESSO */
        #success-screen { display: none; text-align: center; padding: 20px 0; }
        
        .checkmark-circle {
            width: 80px; height: 80px; border-radius: 50%; display: block;
            stroke-width: 2; stroke: var(--success-green); stroke-miterlimit: 10;
            margin: 10% auto; box-shadow: inset 0px 0px 0px var(--success-green);
            animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        }
        .checkmark-check {
            transform-origin: 50% 50%; stroke-dasharray: 48; stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }
        @keyframes stroke { 100% { stroke-dashoffset: 0; } }
        @keyframes scale { 0%, 100% { transform: none; } 50% { transform: scale3d(1.1, 1.1, 1); } }
        @keyframes fill { 100% { box-shadow: inset 0px 0px 0px 30px #fff; } }

        .btn-outline {
            background: transparent; border: 1px solid var(--eztec-cereja);
            color: var(--eztec-cereja); padding: 10px 20px; cursor: pointer; font-weight: 600;
        }

        .simbolo-fixo { position: fixed; bottom: 20px; left: 20px; width: 45px; opacity: 0.8; }
    </style>
</head>
<body>

    <img src="image_b63afa.png" alt="Símbolo Eztec" class="simbolo-fixo">

    <div class="card">
        <div class="header-logo">
            <img src="Logo_Eztec_Cereja.png" alt="Logo Eztec">
        </div>

        <div id="form-content">
            <h2>Treinamento / Capacitação</h2>
            <form id="formulario">
                <div class="grid">
                    <div class="field" style="grid-column: span 2;">
                        <label for="Nome">Nome completo</label>
                        <input type="text" id="Nome" required>
                    </div>
                    
                    <div class="field">
                        <label for="CentroCusto">Centro de custo</label>
                        <input type="text" id="CentroCusto" list="listaCC" placeholder="Buscar..." autocomplete="off">
                        <datalist id="listaCC"></datalist>
                    </div>

                    <div class="field">
                        <label for="Cargo">Cargo</label>
                        <input type="text" id="Cargo">
                    </div>

                    <div class="field">
                        <label for="Diretoria">Diretoria</label>
                        <select id="Diretoria" required>
                            <option value="" disabled selected>Aguarde...</option>
                        </select>
                    </div>

                    <div class="field">
                        <label for="Divisao">Divisão</label>
                        <select id="Divisao" required>
                            <option value="" disabled selected>Escolha...</option>
                            <option value="Escritório">Escritório</option>
                            <option value="Obra">Obra</option>
                        </select>
                    </div>

                    <div class="field">
                        <label for="DataInicio">Data início</label>
                        <input type="text" id="DataInicio" class="datepicker">
                    </div>
                    <div class="field">
                        <label for="DataFim">Data fim</label>
                        <input type="text" id="DataFim" class="datepicker">
                    </div>

                    <div class="field">
                        <label for="HoraInicio">Hora início</label>
                        <input type="text" id="HoraInicio" class="timepicker">
                    </div>
                    <div class="field">
                        <label for="HoraFim">Hora fim</label>
                        <input type="text" id="HoraFim" class="timepicker">
                    </div>

                    <div class="field" style="grid-column: span 2;">
                        <label for="Fornecedor">Fornecedor / facilitador</label>
                        <input type="text" id="Fornecedor">
                    </div>
                </div>
                
                <button type="submit" id="btnEnviar">Concluir Inscrição</button>
            </form>
        </div>

        <div id="success-screen">
            <svg class="checkmark-circle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>
            <h3>Tudo pronto!</h3>
            <p>A inscrição foi realizada com sucesso.</p>
            <button class="btn-outline" onclick="reiniciarFormulario()">Novo Registro</button>
        </div>
    </div>

    <script>
        const SUPABASE_URL = "https://udmpjsxhspgfonzyeard.supabase.co";
        const SUPABASE_KEY = "sb_publishable_jODPibc9Km9xP2QmJ-08cA_sM75Zzsb";
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        flatpickr(".datepicker", { locale: "pt", dateFormat: "Y-m-d", altInput: true, altFormat: "d/m/Y" });
        flatpickr(".timepicker", { enableTime: true, noCalendar: true, dateFormat: "H:i", time_24hr: true });

        async function carregarDiretorias() {
            const { data, error } = await supabaseClient.from('DM_Diretoria').select('Diretoria').order('Diretoria');
            const select = document.getElementById('Diretoria');
            if (!error) {
                select.innerHTML = '<option value="" disabled selected>Selecione...</option>';
                data.forEach(item => {
                    let opt = document.createElement('option');
                    opt.value = item.Diretoria; opt.textContent = item.Diretoria;
                    select.appendChild(opt);
                });
            }
        }
        carregarDiretorias();

        const inputCC = document.getElementById('CentroCusto');
        const dataListCC = document.getElementById('listaCC');

        inputCC.addEventListener('input', async (e) => {
            const termo = e.target.value;
            if (termo.length >= 2) {
                inputCC.classList.add('loading-skeleton');
                try {
                    const { data } = await supabaseClient.from('DM_CentroCusto').select('Centro_Custo').ilike('Centro_Custo', `%${termo}%`).limit(8);
                    dataListCC.innerHTML = "";
                    if (data) data.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.Centro_Custo;
                        dataListCC.appendChild(option);
                    });
                } finally {
                    inputCC.classList.remove('loading-skeleton');
                }
            }
        });

        document.getElementById('formulario').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btnEnviar');
            btn.innerText = "⏳ ENVIANDO...";
            btn.disabled = true;

            const dados = {
                "Nome": document.getElementById('Nome').value,
                "Departamento": document.getElementById('CentroCusto').value,
                "Cargo": document.getElementById('Cargo').value,
                "Diretoria": document.getElementById('Diretoria').value,
                "Divisão": document.getElementById('Divisao').value,
                "DataInicio": document.getElementById('DataInicio').value,
                "DataFim": document.getElementById('DataFim').value,
                "HoraInicio": document.getElementById('HoraInicio').value,
                "HoraFim": document.getElementById('HoraFim').value,
                "Fornecedor/Facilitador": document.getElementById('Fornecedor').value
            };

            const { error } = await supabaseClient.from('FT_Treinamentos').insert([dados]);
            
            if (!error) {
                document.getElementById('form-content').style.display = 'none';
                document.getElementById('success-screen').style.display = 'block';
            } else {
                alert("Erro ao enviar dados.");
                btn.innerText = "CONCLUIR INSCRIÇÃO";
                btn.disabled = false;
            }
        });

        function reiniciarFormulario() {
            document.getElementById('formulario').reset();
            document.getElementById('success-screen').style.display = 'none';
            document.getElementById('form-content').style.display = 'block';
            const btn = document.getElementById('btnEnviar');
            btn.innerText = "CONCLUIR INSCRIÇÃO";
            btn.disabled = false;
        }
    </script>
</body>
</html>